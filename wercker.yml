#The container definition we want to use for developing our app
box: oraclelinux:7.3

build:

 box:
  id: quay.io/fmwplt/12213-domain-novol
  username: $QUAY_IO_USERNAME
  password: $QUAY_IO_PASSWORD
  tag: latest
  cmd: /bin/bash

 steps:
  - script:
     name: "Build the Project -> HelloWorld Web Application"
     code: |
      echo `pwd`
      echo "Building the artifacts required to create HelloWorld web application."
      mvn clean install
      echo ""
      echo "Checking the ["`pwd`"] directory contents :"
      ls -ltr *

  - script:
     name: "Copy the built/compiled artifacts of Web Application"
     code: |
      echo `pwd`
      echo ""
      echo "Copying the built HelloWorldEAR Web Application to required location."
      mkdir -p /u01/oracle/HelloWorld/
      cp -rf resources/HelloWorldEAR.ear /u01/oracle/
      echo "Checking the ["`pwd`"] directory contents :"
      ls -ltr *;echo ""
      cp -r $WERCKER_SOURCE_DIR/. /u01/oracle/HelloWorld/
      echo "Changing the permissions for the compiled artifacts."
      chmod 777 /u01/oracle/HelloWorld/*; echo ""
      echo "Checking the [/u01/oracle/HelloWorld] directory contents"
      ls -ltr /u01/oracle/HelloWorld/*

  - script:
     name: "Stage the artifacts of Web Application"
     code: |
      echo ""
      echo "Checking the ["`pwd`"] directory contents :"
      ls -ltr *;echo ""
      cp -rf /u01/oracle/HelloWorld/* $WERCKER_OUTPUT_DIR/

deploy-webapp-on-weblogic:

 steps:
  - script:
     name: "Just like that"
     code: |
      cat /u01/oracle/domain.properties
      docker

push-release:

 steps:
   - internal/docker-push:
      name: Push the built image to docker repository
      username: $DOCKER_USERNAME
      password: $DOCKER_PASSWORD
      repository: docker.io/fmwplt/HelloWorldWebApp
      tag: $WERCKER_BUILDVERSION
      working-dir: /u01/oracle/HelloWorld/
